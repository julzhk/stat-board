<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">

        <style>
            .panel{ border: 1px solid #ccc; float: left; margin: 0 1% 0 0; padding: 0; width:24%;}
            .panel h1{ background-color: #ccc; margin: 0; padding: 0.25em 0.5em;}
            .panel h2{ display: block; margin: 0; padding: 0;}
            .account{ margin: 0.5em 0; padding: 1em;}
            .sparkline{ border: 1px solid #ccc; height: 50px; width: 100%; }
        </style>

        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script>
            google.load("visualization", "1", {packages:["corechart"]});

            var sparkline_options = {
                curveType: 'function',
                interpolateNulls: true,
                legend: { position: 'none' },
                axisTitlesPosition: 'none',
                titlePosition: 'none',
                hAxis: { 'baselineColor': 'none', 'textPosition': 'none', 'gridlines': {'count': 0} },
                vAxis: { 'baselineColor': 'none', 'textPosition': 'none', 'gridlines': {'count': 0} },
                tooltip: { trigger: 'none' },
                chartArea: {'width': '100%', 'height': '100%'}
            };

            var sparkline_data = {}

            $(window).resize(function(e){drawCharts()});
        </script>
    </head>
    
    <body>

    {% if instaspark[0] %}
    <div class="panel instagram">
        <h1>Instagram</h1>
        {% for spark in instaspark %}

            <div class="account">
                <h2>{{ spark.name }} ({{ spark.data[0]['user_account'] }})</h2>

                <div class="sparkline" id="spark_{{ spark.data[0]['user_account'] }}"></div>

                <span class="count">Followers: {{ spark.data[0]['followers'] }}</span>
            </div>

            <script>
                sparkline_data.spark_{{ spark.data[0]['user_account'] }} = google.visualization.arrayToDataTable([
                    ['DateTime', '{{ spark.name }}'],
                    {% for data in spark['data'] %}
                    [ new Date({{ data['datetime'] }}*1000), {{ data['followers'] }}],
                    {% endfor %}
                ]);
            </script>

        {% endfor %}

        <script type="text/javascript">

            google.setOnLoadCallback(drawCharts);
            function drawCharts(){
                Object.keys(sparkline_data).forEach(function(key){
                    var chart = new google.visualization.LineChart(document.getElementById(key));
                    chart.draw(sparkline_data[key], sparkline_options);
                });
            }

        </script>
    </div>
    {% endif %}

    {% if twitterspark[0] %}
    <div class="panel instagram">
        <h1>Twitter</h1>
        {% for spark in twitterspark %}

            <div class="account">
                <h2>{{ spark.name }} ({{ spark.data[0]['user_account'] }})</h2>

                <div class="sparkline" id="spark_{{ loop.index0 }}"></div>

                <span class="count">Followers: {{ spark.data[0]['followers'] }}</span>
            </div>

            <script>
                sparkline_data.spark_{{ loop.index0 }} = google.visualization.arrayToDataTable([
                    ['DateTime', '{{ spark.name }}'],
                    {% for data in spark['data'] %}
                    [ new Date({{ data['datetime'] }}*1000), {{ data['followers'] }}],
                    {% endfor %}
                ]);
            </script>

        {% endfor %}

        <script type="text/javascript">

            google.setOnLoadCallback(drawCharts);
            function drawCharts(){
                Object.keys(sparkline_data).forEach(function(key){
                    var chart = new google.visualization.LineChart(document.getElementById(key));
                    chart.draw(sparkline_data[key], sparkline_options);
                });
            }

        </script>
    </div>
    {% endif %}


    {#
    {% if vamuseum %}

        <div id="instachart" style="width: 900px; height: 500px;"></div>

        <script type="text/javascript">
            google.setOnLoadCallback(drawChart);
            function drawChart() {
                var data = google.visualization.arrayToDataTable([
                    ['DateTime', 'VAMuseum'],
                    {% for instadata in vamuseum %}
                    [ new Date({{ instadata['datetime'] }}*1000), {{ instadata['followers'] }}],
                    {% endfor %}
                ]);

                var options = {
                    title: '@vamuseum Instagram Followers',
                    vAxis: {'title': 'Number of followers'},
                    hAxis: {'title': 'DateTime', 'format': 'yyyy MM d HH:mm:ss'},
                    curveType: 'function',
                    interpolateNulls: true,
                    legend: { position: 'bottom' }
                };

                var chart = new google.visualization.LineChart(document.getElementById('instachart'));
                chart.draw(data, options);
            }
        </script>
    {% endif %}
    #}

    </body>
    

</html>